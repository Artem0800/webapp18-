<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<title>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</title>
<style>
body {
  font-family: "Segoe UI", sans-serif;
  background: #1e1e1e;
  margin: 0;
  padding: 0;
  color: #f0f0f0;
}

main {
  max-width: 700px;
  margin: 60px auto;
  padding: 30px;
  background: #2a2a2a;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,.4);
}

h1 {
  text-align: center;
  margin-bottom: 25px;
}

/* ===== –ó–í–ï–ó–î–´ ===== */
.rating {
  display: flex;
  flex-direction: row-reverse;
  justify-content: center;
  gap: 8px;
  margin-bottom: 25px;
}

.rating input {
  display: none;
}

.rating label {
  font-size: 34px;
  color: #555;
  cursor: pointer;
  transition: color .25s ease, transform .25s ease;
  opacity: 0;
  transform: translateX(-20px);
  animation: starIn 0.5s ease forwards;
}

.rating label:nth-child(2) { animation-delay: .05s; }
.rating label:nth-child(4) { animation-delay: .1s; }
.rating label:nth-child(6) { animation-delay: .15s; }
.rating label:nth-child(8) { animation-delay: .2s; }
.rating label:nth-child(10){ animation-delay: .25s; }

.rating label:hover,
.rating label:hover ~ label {
  color: #ff4081;
  transform: translateY(-4px) scale(1.1);
}

.rating input:checked ~ label {
  color: #ff4081;
}

.rating input {
  display: none;
}

.rating label {
  font-size: 34px;
  color: #555;
  cursor: pointer;
  transition: color .2s ease, transform .2s ease;
}

.rating label:hover,
.rating label:hover ~ label {
  color: #ff4081;
}

.rating input:checked ~ label {
  color: #ff4081;
}

/* ===== –§–û–†–ú–ê ===== */
.form-group {
  margin-bottom: 20px;
}

textarea {
  width: 100%;
  min-height: 120px;
  background: #1e1e1e;
  border: 1px solid #444;
  border-radius: 12px;
  padding: 14px;
  color: #fff;
  font-size: 15px;
  resize: vertical;
}

textarea:focus {
  outline: none;
  border-color: #ff4081;
}

/* ===== –§–û–¢–û ===== */
input[type="file"] {
  width: 100%;
  background: #1e1e1e;
  border: 1px dashed #555;
  border-radius: 12px;
  padding: 16px;
  color: #ccc;
  cursor: pointer;
}

.preview {
  margin-top: 15px;
  display: none;
}

.preview img {
  max-width: 100%;
  border-radius: 12px;
  box-shadow: 0 6px 20px rgba(0,0,0,.4);
}

/* ===== –ö–ù–û–ü–ö–ê ===== */
button {
  width: 100%;
  padding: 14px;
  border: none;
  border-radius: 50px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  background: linear-gradient(90deg, #ff4081, #c2185b);
  color: #fff;
  box-shadow: 0 6px 20px rgba(255,64,129,.35);
  transition: transform .2s ease, filter .2s ease;
}

button:hover {
  transform: translateY(-2px);
  filter: brightness(1.1);
}
@keyframes starIn {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes formIn {
  from {
    opacity: 0;
    transform: translateY(25px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

main {
  animation: formIn 1.5s ease forwards;
}

/* ===== –ö–†–ê–°–ò–í–ê–Ø –ö–ù–û–ü–ö–ê –î–û–ë–ê–í–õ–ï–ù–ò–Ø –§–û–¢–û ===== */
.file-upload {
  position: relative;
  width: 100%;
}

.file-upload input[type="file"] {
  position: absolute;
  inset: 0;
  opacity: 0;
  cursor: pointer;
}

.file-upload-label {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;

  padding: 16px;
  border-radius: 14px;

  background: linear-gradient(135deg, #ff4081, #c2185b);
  color: #fff;

  font-size: 15px;
  font-weight: 600;

  box-shadow: 0 8px 25px rgba(255,64,129,.35);
  cursor: pointer;

  transition: transform .2s ease, box-shadow .2s ease, filter .2s ease;
}

/* hover ‚Äî –∫–∞–∫ —É –∫–Ω–æ–ø–∫–∏ */
.file-upload-label:hover {
  transform: translateY(-2px);
  filter: brightness(1.1);
  box-shadow: 0 12px 30px rgba(255,64,129,.45);
}

/* –ù–ê–ñ–ê–¢–ò–ï ‚Äî —ç—Ñ—Ñ–µ–∫—Ç –∫–ª–∏–∫–∞ */
.file-upload-label:active {
  transform: scale(0.96);
  box-shadow: 0 6px 15px rgba(255,64,129,.35);
}

.file-upload-label span.icon {
  font-size: 20px;
}

/* ===== PREVIEW –° –ê–ù–ò–ú–ê–¶–ò–ï–ô ===== */
.preview {
  position: relative;
  margin-top: 15px;
  display: none;
  animation: previewIn .4s ease forwards;
}

@keyframes previewIn {
  from {
    opacity: 0;
    transform: scale(.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.preview img {
  max-width: 100%;
  border-radius: 12px;
  box-shadow: 0 6px 20px rgba(0,0,0,.4);
}

/* ===== –ö–ù–û–ü–ö–ê –£–î–ê–õ–ï–ù–ò–Ø –§–û–¢–û ===== */
.remove-photo {
  position: absolute;
  top: 10px;
  right: 10px;

  width: 34px;
  height: 34px;
  border-radius: 50%;

  background: rgba(255,64,129,.45);
  color: #fff;
  border: none;

  cursor: pointer;
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;

  transition: background .2s ease, transform .2s ease;
}

.remove-photo:hover {
  background: #ff4081;
  transform: scale(1.1);
}

/* ===== DRAG & DROP ===== */
.file-upload-label.dragover {
  background: linear-gradient(135deg, #ff4081, #ff6fa1);
  box-shadow: 0 12px 30px rgba(255,64,129,.6);
}

/* ===== –ü–†–û–ó–†–ê–ß–ù–ê–Ø –ö–ù–û–ü–ö–ê –î–û–ë–ê–í–õ–ï–ù–ò–Ø –§–û–¢–û ===== */
.file-upload-label {
  background: transparent;
  border: 2px dashed rgba(255, 255, 255, 0.25);
  color: #ccc;
  box-shadow: none;

  transition:
    border-color .25s ease,
    color .25s ease,
    background .25s ease,
    transform .2s ease;
}

/* hover ‚Äî –º—è–≥–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ */
.file-upload-label:hover {
  background: rgba(255, 64, 129, 0.08);
  border-color: #ff4081;
  color: #ff4081;
  transform: translateY(-2px);
}

/* –Ω–∞–∂–∞—Ç–∏–µ ‚Äî —ç—Ñ—Ñ–µ–∫—Ç –∫–ª–∏–∫–∞ */
.file-upload-label:active {
  transform: scale(0.97);
}

.toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: linear-gradient(135deg, #ff4081, #ff4081);
      color: #fff;
      padding: 14px 20px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
      font-size: 15px;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.35s ease;
      z-index: 9999;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
</style>
</head>
<body>

<main>
  <h1>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h1>

  <div class="rating">
    <input type="radio" id="star5" name="rating" value="5"><label for="star5">‚òÖ</label>
    <input type="radio" id="star4" name="rating" value="4"><label for="star4">‚òÖ</label>
    <input type="radio" id="star3" name="rating" value="3"><label for="star3">‚òÖ</label>
    <input type="radio" id="star2" name="rating" value="2"><label for="star2">‚òÖ</label>
    <input type="radio" id="star1" name="rating" value="1"><label for="star1">‚òÖ</label>
  </div>

  <div class="form-group">
    <textarea class="review-textarea" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –æ—Ç–∑—ã–≤..."></textarea>
  </div>

  <div class="form-group">
    <div class="file-upload">
      <label for="photo" class="file-upload-label" id="uploadLabel">
        <span class="icon">üì∏</span>
        <span id="uploadText">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</span>
      </label>
      <input type="file" accept="image/*" id="photo">
    </div>
    <div class="preview" id="preview"></div>
  </div>

  <button type="button" id="submitBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
</main>
<div id="toast" class="toast"></div>
<script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();
  
    /* –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
    let userName = "–ì–æ—Å—Ç—å";
    if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
      userName = tg.initDataUnsafe.user.first_name;
    }
    document.getElementById("user-name").textContent = userName;


document.addEventListener('DOMContentLoaded', () => {
    const photoInput = document.getElementById('photo');
    const preview = document.getElementById('preview');
    const uploadText = document.getElementById('uploadText');
    const textarea = document.querySelector('.review-textarea');
    const submitButton = document.getElementById('submitBtn');
    const toast = document.getElementById('toast');

    // –§–£–ù–ö–¶–ò–Ø –í–´–ó–û–í–ê TOAST
    function showToast(message) {
        toast.textContent = message;
        toast.classList.add('show');
        setTimeout(() => {
            toast.classList.remove('show');
        }, 1550);
    }

    function showImage(file) {
        preview.innerHTML = '';
        if (!file.type.startsWith('image/')) {
            showToast('–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
            return;
        }
        const img = document.createElement('img');
        img.src = URL.createObjectURL(file);
        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove-photo';
        removeBtn.innerHTML = '√ó';
        removeBtn.onclick = () => {
            photoInput.value = '';
            preview.style.display = 'none';
            uploadText.textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é';
        };
        preview.appendChild(img);
        preview.appendChild(removeBtn);
        preview.style.display = 'block';
        uploadText.textContent = '–§–æ—Ç–æ –≤—ã–±—Ä–∞–Ω–æ';
    }

    photoInput.addEventListener('change', () => {
        if (photoInput.files[0]) showImage(photoInput.files[0]);
    });

    submitButton.addEventListener('click', async () => {
        const starInputs = document.querySelectorAll('input[name="rating"]');
        let ratingValue = '';
        starInputs.forEach(input => { if (input.checked) ratingValue = input.value; });

        const text = textarea.value.trim();

        if (!ratingValue) return showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É');
        if (!text) return showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞');

        let imgBase64 = '';
        if (photoInput.files[0]) {
            const reader = new FileReader();
            imgBase64 = await new Promise(r => {
                reader.onload = () => r(reader.result);
                reader.readAsDataURL(photoInput.files[0]);
            });
        }

        const reviewData = {
            count_reviews: ratingValue.toString(), // –í –≤–∞—à–µ–π –º–æ–¥–µ–ª–∏ —ç—Ç–æ str
            text: text,
            img: imgBase64,
            username: userName
        };

        try {
            submitButton.disabled = true;
            submitButton.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';

            const response = await fetch('http://127.0.0.1:8000/add_to_reviews', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(reviewData)
            });

            if (!response.ok) throw new Error();

            showToast('–°–ø–∞—Å–∏–±–æ! –û—Ç–∑—ã–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');

            
            // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
            textarea.value = '';
            photoInput.value = '';
            starInputs.forEach(i => i.checked = false);
            preview.style.display = 'none';
            uploadText.textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é';

        } catch (err) {
            showToast('–û—à–∏–±–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
        } finally {
            submitButton.disabled = false;
            submitButton.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤';
        }
    });
});
</script>
</body>

</html>

